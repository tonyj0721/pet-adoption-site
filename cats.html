<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>所有貓咪｜貓狗送養平台</title>
<style>
  :root{ --green:#497f54; --mint:#9ed2a3; --bg:#f8f9f7; }
  body{ margin:0; font-family:'Noto Sans TC',system-ui; background:var(--bg); color:#333 }
  header{ background:var(--mint); color:#fff }
  .nav{ max-width:1100px; margin:auto; display:flex; align-items:center; justify-content:space-between; padding:1rem }
  .nav a{ color:#fff; text-decoration:none; margin-left:1rem; font-weight:600 }
  .container{ max-width:1100px; margin:1.2rem auto; padding:0 1rem }
  .filters{ display:grid; grid-template-columns:repeat(3,1fr); gap:.8rem; background:#fff; padding:1rem; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.06); }
  select{ width:100%; padding:.6rem; border:1px solid #ccc; border-radius:8px }
  .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1rem; margin-top:1rem }
  .card{ background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.06); overflow:hidden; }
  .card img{ width:100%; height:160px; object-fit:cover; display:block }
  .info{ padding:.8rem }
  .pill{ display:inline-block; background:#eef6ef; color:#2d5b39; padding:.16rem .5rem; border-radius:999px; font-size:.8rem; margin-right:.4rem }
  .pager{ display:flex; justify-content:center; align-items:center; gap:.6rem; margin:1rem 0 }
  .pager button{ padding:.4rem .7rem; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer }
  .empty{ text-align:center; color:#666; padding:1rem }
</style>
</head>
<body>
<header>
  <div class="nav">
    <div style="font-weight:800">貓狗送養平台</div>
    <nav>
      <a href="index.html">首頁</a>
      <a href="adoptlist.html">待認養</a>
      <a href="about.html">關於簡媽媽</a>
    </nav>
  </div>
</header>

<main class="container">
  <h2 style="color:#497f54;margin:.2rem 0 1rem">所有貓咪</h2>
  <div class="filters">
    <select id="fColor">
      <option value="">不限毛色</option>
      <option>橘貓</option><option>虎斑</option><option>白底虎斑</option>
      <option>賓士</option><option>乳牛</option><option>三花</option>
      <option>玳瑁</option><option>黑貓</option><option>品種貓</option>
    </select>
    <select id="fAge">
      <option value="">不限年齡</option>
      <option>幼年</option><option>成年</option><option>高齡</option>
    </select>
    <select id="fGender">
      <option value="">不限性別</option>
      <option>男生</option><option>女生</option>
    </select>
  </div>

  <div id="grid" class="grid"></div>
  <div id="empty" class="empty" style="display:none">目前沒有符合條件的貓咪</div>
  <div class="pager">
    <button id="prev">上一頁</button>
    <span id="pageInfo"></span>
    <button id="next">下一頁</button>
  </div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy, where } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyADseNNkszDTbwEk4F03_rC0fo4Rnk0iBM",
    authDomain: "pet-adoption-32294.firebaseapp.com",
    projectId: "pet-adoption-32294",
    storageBucket: "pet-adoption-32294.firebasestorage.app",
    messagingSenderId: "102978803311",
    appId: "1:102978803311:web:a7d890096b2b23cad15f9a"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const q=(s,el=document)=>el.querySelector(s);
  const grid = q('#grid'), empty=q('#empty');
  let all=[], filtered=[], page=1, per=12;

  function card(p){
    const el=document.createElement('div');
    el.className='card';
    const cover=p.images?.[0]?.url || 'https://placehold.co/600x400?text=No+Image';
    el.innerHTML=`
      <img src="${cover}" alt="${p.name||''}">
      <div class="info">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>${p.name||''}</strong><span class="pill">貓咪</span>
        </div>
        <div style="font-size:.92rem;margin-top:.25rem">
          <div>毛色：${p.color||'—'}</div>
          <div>年齡：${p.age||'—'}　性別：${p.gender||'—'}</div>
        </div>
      </div>`;
    el.addEventListener('click',()=>{
      const url=new URL('adopt.html',location.href);
      url.searchParams.set('pet', p.id||'');
      location.href=url.toString();
    });
    return el;
  }

  function applyFilters(){
    const color=q('#fColor').value.trim();
    const age=q('#fAge').value.trim();
    const gender=q('#fGender').value.trim();
    filtered = all.filter(p=>{
      if(color && p.color!==color) return false;
      if(age && p.age!==age) return false;
      if(gender && p.gender!==gender) return false;
      return true;
    });
    page=1; render();
  }

  function render(){
    grid.innerHTML='';
    const total=filtered.length;
    const pages=Math.max(1, Math.ceil(total/per));
    page=Math.min(page,pages);
    const slice=filtered.slice((page-1)*per, page*per);
    slice.forEach(p=>grid.appendChild(card(p)));
    q('#pageInfo').textContent=`第 ${page} / ${pages} 頁（共 ${total} 筆）`;
    empty.style.display = total? 'none':'block';
  }

  q('#prev').onclick=()=>{ if(page>1){ page--; render(); } };
  q('#next').onclick=()=>{ const pages=Math.max(1,Math.ceil(filtered.length/per)); if(page<pages){ page++; render(); } };
  q('#fColor').onchange=q('#fAge').onchange=q('#fGender').onchange=applyFilters;

  (async ()=>{
    const ref = collection(db,'pets');
    const qs = await getDocs(query(ref, where('species','==','cat'), orderBy('createdAt','desc')));
    all = qs.docs.map(d=>({ id:d.id, ...d.data() }));
    filtered = all.slice();
    render();
  })();
</script>
</body>
</html>
