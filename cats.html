<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>我想養貓咪｜台中簡媽媽狗園</title>

  <link rel="stylesheet" href="style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <header>
    <div class="nav">
      <div style="font-weight:800;font-size:1.1rem;">台中簡媽媽狗園</div>
      <div>
        <a class="btn btn-ghost" href="index.html">首頁</a>
      </div>
    </div>
  </header>

  <main class="container">
    <h2 class="section-title">待領養的貓咪</h2>
    <div id="catList" class="grid"></div>
  </main>

  <footer>© 2025 台中簡媽媽狗園｜讓愛延續每一個生命</footer>

  <!-- 貓咪詳細資料 Modal -->
  <div id="catModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-panel">
      <div class="m-hero">
        <button class="icon-btn m-close" id="closeModal"><i class="fa-solid fa-xmark"></i></button>
        <div class="m-title" id="mName">貓咪資料</div>
        <div class="m-icon"><i class="fa-solid fa-cat"></i></div>
      </div>

      <div class="m-body">
        <div>
          <img id="mMain" class="m-main-img" src="" alt="">
          <div id="mThumbs" class="m-thumbs"></div>
        </div>
        <div>
          <div class="meta">
            <p><span class="pill" id="mSpecies">貓咪</span></p>
            <p>品種：<span id="mBreed"></span></p>
            <p>年齡：<span id="mAge"></span></p>
            <p>性別：<span id="mGender"></span></p>
            <p style="margin-top:.6rem;white-space:pre-wrap">介紹：<span id="mIntro"></span></p>
          </div>
          <button class="btn" style="width:100%;margin-top:.8rem;" id="adoptBtn">我要領養</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase 腳本 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyADseNNkszDTbwEk4F03_rC0fo4Rnk0iBM",
      authDomain: "pet-adoption-32294.firebaseapp.com",
      projectId: "pet-adoption-32294",
      storageBucket: "pet-adoption-32294.firebasestorage.app",
      messagingSenderId: "102978803311",
      appId: "1:102978803311:web:a7d890096b2b23cad15f9a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const catList = document.getElementById("catList");
    const catModal = document.getElementById("catModal");
    const mName = document.getElementById("mName");
    const mMain = document.getElementById("mMain");
    const mThumbs = document.getElementById("mThumbs");
    const mBreed = document.getElementById("mBreed");
    const mAge = document.getElementById("mAge");
    const mGender = document.getElementById("mGender");
    const mIntro = document.getElementById("mIntro");
    const closeModal = document.getElementById("closeModal");

    // 關閉 Modal
    closeModal.addEventListener("click", () => catModal.classList.remove("open"));
    catModal.addEventListener("click", (e) => {
      if (e.target.classList.contains("modal-backdrop")) catModal.classList.remove("open");
    });

    // 取得資料
    async function loadCats() {
      const ref = collection(db, "pets");
      const qs = await getDocs(query(ref, where("species", "==", "cat"), orderBy("createdAt", "desc")));
      const cats = qs.docs.map(d => ({ id: d.id, ...d.data() }));
      renderCats(cats);
    }

    // 顯示卡片
    function renderCats(data) {
      catList.innerHTML = "";
      data.forEach(c => {
        const div = document.createElement("div");
        div.className = "card";
        const img = c.images?.[0]?.url || "https://placehold.co/400x300?text=No+Image";
        div.innerHTML = `
          <img src="${img}" alt="${c.name}">
          <div class="info">
            <h3>${c.name || "未命名"}</h3>
            <p>${c.breed || ""}</p>
          </div>`;
        div.addEventListener("click", () => openModal(c));
        catList.appendChild(div);
      });
    }

    // 開啟 Modal
    function openModal(c) {
      mName.textContent = c.name;
      mBreed.textContent = c.breed || "-";
      mAge.textContent = c.age || "-";
      mGender.textContent = c.gender || "-";
      mIntro.textContent = c.intro || "";
      const imgs = (c.images?.length) ? c.images.map(i => i.url) : ["https://placehold.co/1200x800?text=No+Image"];
      let current = 0;
      mMain.src = imgs[0];
      mThumbs.innerHTML = "";
      imgs.forEach((src, i) => {
        const im = new Image();
        im.src = src;
        im.addEventListener("click", () => {
          current = i;
          mMain.src = imgs[current];
          highlight();
        });
        mThumbs.appendChild(im);
      });
      function highlight() {
        [...mThumbs.querySelectorAll("img")].forEach((img, idx) => img.classList.toggle("active", idx === current));
      }
      highlight();
      catModal.classList.add("open");
    }

    loadCats();
  </script>
</body>
</html>
