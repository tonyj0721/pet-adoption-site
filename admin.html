<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>後台管理｜台中簡媽媽狗園</title>

  <link rel="stylesheet" href="style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <header>
    <div class="nav">
      <div style="font-weight:800;font-size:1.1rem;">台中簡媽媽狗園</div>
      <div>
        <button id="logoutBtn" class="btn btn-ghost">登出</button>
      </div>
    </div>
  </header>

  <main class="container">
    <h2 class="section-title">登錄新動物</h2>
    <form id="addAnimalForm" class="grid2" style="max-width:700px;margin:auto;">
      <div>
        <label>姓名</label>
        <input type="text" id="name" required>
      </div>
      <div>
        <label>類別</label>
        <select id="species" required>
          <option value="dog">狗</option>
          <option value="cat">貓</option>
        </select>
      </div>
      <div>
        <label>品種</label>
        <input type="text" id="breed">
      </div>
      <div>
        <label>年齡</label>
        <input type="text" id="age">
      </div>
      <div>
        <label>性別</label>
        <select id="gender">
          <option value="男生">男生</option>
          <option value="女生">女生</option>
        </select>
      </div>
      <div>
        <label>介紹</label>
        <textarea id="intro" rows="3"></textarea>
      </div>
      <button class="btn" type="submit" style="grid-column:1/-1;">新增動物</button>
    </form>

    <h2 class="section-title" style="margin-top:2rem;">已登錄動物資料</h2>
    <div id="animalList" class="list-table"></div>
  </main>

  <footer>© 2025 台中簡媽媽狗園｜讓愛延續每一個生命</footer>

  <!-- 詳細資料 Modal -->
  <div id="animalModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-panel" style="max-width:460px;">
      <div class="m-hero" style="background:#7b68ee;color:#fff;">
        <button class="icon-btn m-close" id="closeModal"><i class="fa-solid fa-xmark"></i></button>
        <div class="m-title" id="mName">動物資料</div>
        <div class="m-actions">
          <button class="icon-btn" id="editBtn"><i class="fa-solid fa-pen"></i></button>
          <button class="icon-btn" id="deleteBtn"><i class="fa-solid fa-trash"></i></button>
        </div>
      </div>
      <div class="m-body">
        <div class="meta">
          <p>類別：<span id="mSpecies"></span></p>
          <p>品種：<span id="mBreed"></span></p>
          <p>年齡：<span id="mAge"></span></p>
          <p>性別：<span id="mGender"></span></p>
          <p style="margin-top:.6rem;white-space:pre-wrap">介紹：<span id="mIntro"></span></p>
        </div>
        <button class="btn disabled" style="width:100%;margin-top:1rem;background:#aaa;cursor:default;">已領養</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyADseNNkszDTbwEk4F03_rC0fo4Rnk0iBM",
      authDomain: "pet-adoption-32294.firebaseapp.com",
      projectId: "pet-adoption-32294",
      storageBucket: "pet-adoption-32294.firebasestorage.app",
      messagingSenderId: "102978803311",
      appId: "1:102978803311:web:a7d890096b2b23cad15f9a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const addAnimalForm = document.getElementById('addAnimalForm');
    const animalList = document.getElementById('animalList');
    const animalModal = document.getElementById('animalModal');
    const closeModal = document.getElementById('closeModal');
    const logoutBtn = document.getElementById('logoutBtn');

    const mName = document.getElementById('mName');
    const mSpecies = document.getElementById('mSpecies');
    const mBreed = document.getElementById('mBreed');
    const mAge = document.getElementById('mAge');
    const mGender = document.getElementById('mGender');
    const mIntro = document.getElementById('mIntro');

    // 登出按鈕
    logoutBtn.addEventListener('click', ()=> {
      window.location.href = "index.html";
    });

    // 關閉 Modal
    closeModal.addEventListener('click', ()=> animalModal.classList.remove('open'));
    animalModal.addEventListener('click', (e)=>{
      if(e.target.classList.contains('modal-backdrop')) animalModal.classList.remove('open');
    });

    // 新增動物
    addAnimalForm.addEventListener('submit', async e=>{
      e.preventDefault();
      const data = {
        name: document.getElementById('name').value,
        species: document.getElementById('species').value,
        breed: document.getElementById('breed').value,
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value,
        intro: document.getElementById('intro').value,
        createdAt: new Date()
      };
      await addDoc(collection(db,"pets"), data);
      addAnimalForm.reset();
      loadAnimals();
    });

    // 載入資料
    async function loadAnimals(){
      animalList.innerHTML = "";
      const q = query(collection(db, "pets"), orderBy("createdAt", "desc"));
      const qs = await getDocs(q);
      qs.forEach(doc=>{
        const d = doc.data();
        const row = document.createElement("div");
        row.className = "list-row";
        row.innerHTML = `
          <div>${d.name||"未命名"}</div>
          <div>${d.species==="dog"?"狗":"貓"}</div>
          <div>${d.breed||"-"}</div>
          <div>${d.age||"-"}</div>
          <div>${d.gender||"-"}</div>
        `;
        row.addEventListener("click", ()=> openModal(d));
        animalList.appendChild(row);
      });
    }

    // 開啟詳細資料
    function openModal(d){
      mName.textContent = d.name || "-";
      mSpecies.textContent = d.species==="dog"?"狗":"貓";
      mBreed.textContent = d.breed || "-";
      mAge.textContent = d.age || "-";
      mGender.textContent = d.gender || "-";
      mIntro.textContent = d.intro || "";
      animalModal.classList.add('open');
    }

    loadAnimals();
  </script>

  <style>
    .list-table {
      max-width: 1000px;
      margin: auto;
      display: grid;
      gap: .6rem;
    }
    .list-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      background: #fff;
      padding: .8rem;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,.05);
      cursor: pointer;
      transition: .2s;
    }
    .list-row:hover {
      background: #f4f8f4;
    }
    .m-hero {
      position: relative;
      padding: 1rem;
      border-radius: 10px 10px 0 0;
    }
    .m-actions {
      position: absolute;
      right: 1rem;
      top: 1rem;
      display: flex;
      gap: .6rem;
    }
    @media(max-width:768px){
      .list-row { grid-template-columns: repeat(2, 1fr); text-align:left; }
    }
  </style>
</body>
</html>
